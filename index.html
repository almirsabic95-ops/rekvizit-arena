<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rekvizit Arena - Ultimate Edition</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root { --bg: #050505; --panel: #121212; --accent: #00eaff; --gold: #ffd700; --red: #ff4d4d; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }

        /* LIJEVA STRANA - ONLINE LISTA */
        #left-sidebar { width: 260px; background: #000; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .sidebar-title { padding: 15px; color: var(--accent); font-weight: bold; border-bottom: 1px solid #222; text-align: center; }
        #online-list { flex: 1; overflow-y: auto; padding: 10px; }
        .user-card { display: flex; align-items: center; gap: 10px; padding: 8px; margin-bottom: 5px; background: #111; border-radius: 5px; cursor: pointer; border: 1px solid transparent; }
        .user-card:hover { border-color: var(--accent); background: #1a1a1a; }
        .av-small { width: 35px; height: 35px; border-radius: 50%; border: 2px solid #444; }

        /* SREDINA - KVIZ I NAVIGACIJA */
        #main-container { flex: 1; display: flex; flex-direction: column; position: relative; }
        .nav-top { height: 60px; background: #0a0a0a; border-bottom: 1px solid #333; display: flex; align-items: center; padding: 0 20px; gap: 10px; }
        .btn-nav { background: #222; border: 1px solid #444; color: white; padding: 8px 15px; cursor: pointer; border-radius: 4px; font-weight: bold; font-size: 13px; }
        .btn-nav:hover { background: var(--accent); color: black; }

        /* KVIZ ZONA */
        #quiz-zone { flex: 1; padding: 40px; text-align: center; background: radial-gradient(circle, #151515, #000); }
        #timer { font-size: 60px; font-weight: bold; color: var(--accent); margin: 10px 0; }
        .input-box { width: 60%; padding: 15px; font-size: 18px; background: #000; border: 2px solid var(--accent); color: white; text-align: center; border-radius: 8px; }

        /* CHAT ZONA */
        #global-chat { height: 200px; background: #080808; border-top: 1px solid #333; display: flex; flex-direction: column; }
        #messages { flex: 1; overflow-y: auto; padding: 15px; text-align: left; font-size: 14px; }
        .msg-ans { color: #888; font-style: italic; }
        .msg-system { color: var(--gold); font-weight: bold; }

        /* PRIVATNI CHAT PROZOR */
        #private-chat-window { position: absolute; bottom: 20px; right: 20px; width: 300px; height: 400px; background: #111; border: 1px solid var(--accent); border-radius: 10px; display: flex; flex-direction: column; z-index: 500; }
        #pc-header { background: var(--accent); color: black; padding: 10px; font-weight: bold; display: flex; justify-content: space-between; border-radius: 10px 10px 0 0; }
        #pc-msgs { flex: 1; overflow-y: auto; padding: 10px; font-size: 13px; }

        /* LOGIN */
        #login-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; align-items: center; justify-content: center; }
        .login-box { background: var(--panel); padding: 40px; border-radius: 15px; border: 1px solid #333; width: 350px; text-align: center; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box" id="auth-form">
            <h1 style="color: var(--accent); letter-spacing: 2px;">REKVIZIT ARENA</h1>
            <p style="font-size: 12px; color: #777;">Ulazom prihva캖ate na코a pravila i uslove.</p>
            <input type="text" id="nick" placeholder="Nadimak" style="width:100%; padding:10px; margin:5px 0; background:#000; color:white; border:1px solid #444;">
            <input type="password" id="pass" placeholder="Lozinka" style="width:100%; padding:10px; margin:5px 0; background:#000; color:white; border:1px solid #444;">
            <input type="password" id="secret" placeholder="Tajna 코ifra" style="width:100%; padding:10px; margin:5px 0; background:#000; color:white; border:1px solid #444;">
            <button class="btn-nav" style="width:100%; margin-top:10px; background:var(--accent); color:black;" onclick="prijaviSe()">U캟I U ARENU</button>
            <p style="font-size: 11px; color: var(--accent); cursor: pointer; margin-top: 15px;" onclick="alert('Kontaktiraj admina s tajnom 코ifrom!')">Zaboravljena lozinka?</p>
        </div>
    </div>

    <div id="left-sidebar">
        <div class="sidebar-title">ONLINE IGRA캛I</div>
        <div id="online-list"></div>
        <div style="padding: 10px; text-align: center; color: var(--accent); cursor: pointer; font-size: 11px;" onclick="alert('Otvaram pro코irenu tablicu...')">vi코e >>>></div>
    </div>

    <div id="main-container">
        <div class="nav-top">
            <button class="btn-nav" onclick="location.reload()">KVIZ</button>
            <button class="btn-nav">1vs1 DVOBOJ</button>
            <button class="btn-nav">TABLICA</button>
            <button class="btn-nav">KOLO SRE캕E</button>
            <button class="btn-nav">TRGOVINA</button>
            <button class="btn-nav">PRAVILA</button>
            <div style="flex:1"></div>
            <span id="moj-score" style="color: var(--gold)">0 游눯</span>
            <button class="btn-nav" style="color: var(--red)" onclick="location.reload()">ODJAVA</button>
        </div>

        <div id="quiz-zone">
            <div id="timer">30</div>
            <h2 id="pitanje-tekst">Odaberi kategoriju ili 캜ekaj pitanje...</h2>
            <input type="text" id="ans-input" class="input-box" placeholder="Upi코i odgovor i pritisni ENTER..." onkeydown="if(event.key==='Enter') posaljiOdgovor()">
        </div>

        <div id="global-chat">
            <div id="messages"></div>
        </div>
    </div>

    <div id="private-chat-window" class="hidden">
        <div id="pc-header">
            <span id="pc-with">Chat</span>
            <span style="cursor:pointer" onclick="zatvoriPrivatni()">X</span>
        </div>
        <div id="pc-msgs"></div>
        <input type="text" id="pc-input" placeholder="Pi코i privatno..." style="border:none; padding:10px; background:#222; color:white;" onkeydown="if(event.key==='Enter') posaljiPrivatnu()">
    </div>

    <div id="profile-modal" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:2000; display:flex; align-items:center; justify-content:center;">
        <div style="background:#111; padding:30px; border-radius:10px; text-align:center; border:1px solid var(--accent); width:300px;">
            <img id="p-img" src="" style="width:80px; height:80px; border-radius:50%; border:2px solid var(--accent);">
            <h2 id="p-nick">Ime</h2>
            <p id="p-stats">Bodovi: 0</p>
            <button class="btn-nav" id="btn-msg-start">POㅁLJI PORUKU</button><br><br>
            <button class="btn-nav" onclick="document.getElementById('profile-modal').classList.add('hidden')">Zatvori</button>
        </div>
    </div>
    <script>
        const socket = io();
        let mojNadimak = "";
        let privatniChatSId = "";

        function prijaviSe() {
            const n = document.getElementById('nick').value;
            const p = document.getElementById('pass').value;
            const s = document.getElementById('secret').value;
            if(!n || !p || !s) return alert("Popuni sve!");
            socket.emit('prijava', { nadimak: n, lozinka: p, tajna_sifra: s });
        }

        socket.on('prijavljen', (u) => {
            mojNadimak = u.nadimak;
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('moj-score').innerText = u.ukupni_bodovi + " 游눯";
        });

        function posaljiOdgovor() {
            const inp = document.getElementById('ans-input');
            socket.emit('slanje_odgovora', inp.value);
            inp.value = "";
        }

        // ONLINE LISTA I PROFIL
        socket.on('update_online_list', (users) => {
            const list = document.getElementById('online-list');
            list.innerHTML = users.map(u => `
                <div class="user-card" onclick="otvoriProfil('${u.nadimak}', '${u.id}', '${u.avatar}', ${u.bodovi})">
                    <img src="${u.avatar}" class="av-small">
                    <span>${u.nadimak} (${u.bodovi})</span>
                </div>
            `).join('');
        });

        function otvoriProfil(nick, sid, av, bodovi) {
            if(nick === mojNadimak) return;
            document.getElementById('p-nick').innerText = nick;
            document.getElementById('p-img').src = av;
            document.getElementById('p-stats').innerText = "Bodovi: " + bodovi;
            document.getElementById('btn-msg-start').onclick = () => {
                otvoriPrivatni(sid, nick);
                document.getElementById('profile-modal').classList.add('hidden');
            };
            document.getElementById('profile-modal').classList.remove('hidden');
        }

        // PRIVATNE PORUKE
        function otvoriPrivatni(sid, nick) {
            privatniChatSId = sid;
            document.getElementById('pc-with').innerText = "Chat: " + nick;
            document.getElementById('pc-msgs').innerHTML = ""; // Bri코e stare poruke pri otvaranju
            document.getElementById('private-chat-window').classList.remove('hidden');
        }

        function posaljiPrivatnu() {
            const inp = document.getElementById('pc-input');
            socket.emit('privatna_poruka', { komeId: privatniChatSId, tekst: inp.value });
            document.getElementById('pc-msgs').innerHTML += `<div><b>Ja:</b> ${inp.value}</div>`;
            inp.value = "";
        }

        socket.on('primljena_privatna', (data) => {
            otvoriPrivatni(data.odId, data.od);
            document.getElementById('pc-msgs').innerHTML += `<div style="color:var(--accent)"><b>${data.od}:</b> ${data.tekst}</div>`;
        });

        function zatvoriPrivatni() { document.getElementById('private-chat-window').classList.add('hidden'); }

        // KVIZ LOGIKA
        socket.on('novo_pitanje', d => {
            document.getElementById('pitanje-tekst').innerText = d.pitanje;
        });

        socket.on('vrijeme', s => {
            document.getElementById('timer').innerText = s;
            document.getElementById('timer').style.color = s <= 10 ? 'red' : 'var(--accent)';
        });

        socket.on('globalni_odgovor_prikaz', d => {
            const msgBox = document.getElementById('messages');
            msgBox.innerHTML += `<div class="msg-ans"><b>${d.igrac}:</b> ${d.tekst}</div>`;
            msgBox.scrollTop = msgBox.scrollHeight;
        });

        socket.on('rezultat_odgovora', res => {
            const msgBox = document.getElementById('messages');
            const boja = res.to캜no ? "var(--accent)" : "red";
            msgBox.innerHTML += `<div style="color:${boja}">Sustav: ${res.to캜no ? 'TO캛NO! +'+res.osvojeno : 'NETO캛NO! -2'}</div>`;
            msgBox.scrollTop = msgBox.scrollHeight;
        });

        socket.on('obavijest', m => alert(m));
    </script>
</body>
</html>