<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <title>Rekvizit Arena Ultimate</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root { --accent: #00d2ff; --gold: #ffcc00; --bg: #050505; --card: #121212; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }

        /* LOGIN & MODALI */
        #login-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .box { background: var(--card); padding: 40px; border-radius: 15px; border: 1px solid #333; width: 350px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #444; color: white; border-radius: 5px; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; background: var(--accent); border: none; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 10px; }

        /* LEADERBOARD SIDEBAR */
        #sidebar { width: 320px; background: #000; border-right: 1px solid #222; display: flex; flex-direction: column; }
        .tabs { display: flex; background: #111; font-size: 10px; cursor: pointer; }
        .tabs div { flex: 1; padding: 15px; text-align: center; border-bottom: 2px solid transparent; }
        .tabs div.active { border-color: var(--accent); color: var(--accent); }
        .row { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #111; font-size: 13px; }

        /* MAIN APP */
        #app { flex: 1; display: flex; flex-direction: column; }
        .nav { height: 60px; background: #0a0a0a; border-bottom: 1px solid #222; display: flex; align-items: center; padding: 0 20px; gap: 20px; }
        .nav-item { cursor: pointer; font-size: 14px; font-weight: bold; opacity: 0.7; }
        .nav-item:hover { opacity: 1; color: var(--accent); }

        /* KVIZ ZONA */
        #quiz { flex: 1; text-align: center; padding: 50px; background: radial-gradient(circle at center, #151515, #050505); }
        .kat { background: var(--accent); color: black; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 12px; text-transform: uppercase; }
        #chat { height: 200px; background: #080808; border-top: 1px solid #222; padding: 15px; overflow-y: auto; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="box" id="login-form">
            <h1 style="letter-spacing: 3px;">ARENA</h1>
            <input type="text" id="l-nick" placeholder="Nadimak" onkeypress="if(event.key==='Enter') login()">
            <input type="password" id="l-pass" placeholder="Lozinka" onkeypress="if(event.key==='Enter') login()">
            <button class="btn" onclick="login()">ULAZ U ARENU</button>
            <p style="font-size: 11px; color: #666; cursor: pointer; margin-top: 15px;" onclick="prikaziZaboravljeno()">Zaboravljena lozinka?</p>
        </div>
        <div class="box hidden" id="reg-form">
            <p style="color:var(--accent)">Postavi tajnu ≈°ifru za oporavak:</p>
            <input type="password" id="r-secret" placeholder="Tajna ≈°ifra">
            <button class="btn" onclick="registriraj()">DOVR≈†I</button>
        </div>
        <div class="box hidden" id="zaboravljeno-form">
            <h3>Oporavak Raƒçuna</h3>
            <input id="z-nick" placeholder="Nadimak">
            <input id="z-pass" placeholder="Nova lozinka">
            <input id="z-tajna" placeholder="Tajna ≈°ifra">
            <input id="z-razlog" placeholder="Razlog">
            <button class="btn" onclick="posaljiZahtjev()">PO≈†ALJI ZAHTJEV</button>
        </div>
    </div>
    <div id="sidebar">
        <div class="tabs">
            <div class="active">UKUPNO</div>
            <div>DNEVNO</div>
            <div>ONLINE</div>
        </div>
        <div id="lb-content" style="flex:1; overflow-y:auto;"></div>
    </div>

    <div id="app">
        <div class="nav">
            <div class="nav-item">KVIZ</div>
            <div class="nav-item">TRGOVINA</div>
            <div class="nav-item">PRAVILA</div>
            <div style="flex:1"></div>
            <span id="stat-coins" style="color:var(--gold)">0 üí∞</span>
            <div id="my-profile" style="width:35px; height:35px; border-radius:50%; background:#333; cursor:pointer;"></div>
            <div class="nav-item" style="color:red" onclick="location.reload()">ODJAVA</div>
        </div>

        <div id="quiz">
            <span id="q-kat" class="kat">KATEGORIJA</span>
            <h1 id="q-text" style="font-size: 3em; margin: 40px 0;">Spremite se...</h1>
            <input type="text" id="q-ans" placeholder="Upi≈°i odgovor i pritisni Enter" style="width: 70%; font-size: 1.5em; text-align: center;" onkeypress="if(event.key==='Enter') posaljiOdgovor()">
        </div>

        <div id="chat"></div>
        <input id="chat-in" placeholder="Napi≈°i poruku i pritisni Enter..." style="background:#000; border:none; padding:15px; color:white; border-top:1px solid #333;" onkeypress="if(event.key==='Enter') posaljiChat()">
    </div>

    <div id="rules-overlay" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:20000; display:flex; align-items:center; justify-content:center;">
        <div class="box" style="width:450px;">
            <h2>Pravila i Uvjeti</h2>
            <p style="text-align:left; font-size:14px; color:#aaa;">
                ‚óè Svaki pogre≈°an odgovor oduzima -2 boda.<br>
                ‚óè Zabranjeno je varanje i vrijeƒëanje.<br>
                ‚óè 1vs1 pobjednik uzima ulog bodova.
            </p>
            <button class="btn" onclick="prihvatiRules()">PRIHVAƒÜAM I ULAZIM</button>
        </div>
    </div>

    <script>
        const socket = io();

        function login() {
            socket.emit('pokusaj_prijave', { nadimak: document.getElementById('l-nick').value, lozinka: document.getElementById('l-pass').value });
        }

        socket.on('otvori_registraciju', () => {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('reg-form').classList.remove('hidden');
        });

        function registriraj() {
            socket.emit('registracija', { 
                nadimak: document.getElementById('l-nick').value, 
                lozinka: document.getElementById('l-pass').value, 
                tajna_sifra: document.getElementById('r-secret').value 
            });
        }

        socket.on('prijava_uspjesna', (u) => {
            document.getElementById('login-overlay').classList.add('hidden');
            if(!u.prihvacenaPravila) document.getElementById('rules-overlay').classList.remove('hidden');
            document.getElementById('stat-coins').innerText = u.coinsi + " üí∞";
        });

        function posaljiOdgovor() {
            const inp = document.getElementById('q-ans');
            socket.emit('slanje_odgovora', { odgovor: inp.value });
            inp.value = "";
        }

        function posaljiChat() {
            const inp = document.getElementById('chat-in');
            socket.emit('chat_global', inp.value);
            inp.value = "";
        }

        socket.on('novo_pitanje', d => {
            document.getElementById('q-text').innerText = d.tekst;
            document.getElementById('q-kat').innerText = d.kat;
        });

        socket.on('update_leaderboard', data => {
            const list = document.getElementById('lb-content');
            list.innerHTML = data.ukupno.map((u, i) => `
                <div class="row">
                    <span style="width:25px; color:var(--accent)">${i+1}.</span>
                    <div style="flex:1"><b>${u.nadimak}</b></div>
                    <div style="color:var(--accent)">${u.bodovi}</div>
                </div>
            `).join('');
        });

        socket.on('chat_msg', d => {
            const box = document.getElementById('chat');
            box.innerHTML += `<div><b style="color:var(--accent)">${d.od}:</b> ${d.tekst}</div>`;
            box.scrollTop = box.scrollHeight;
        });

        function prihvatiRules() {
            socket.emit('prihvati_uvjete');
            document.getElementById('rules-overlay').classList.add('hidden');
        }

        function prikaziZaboravljeno() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('zaboravljeno-form').classList.remove('hidden');
        }

        function posaljiZahtjev() {
            alert("Ukoliko su podaci ispravni, administrator ƒáe odobriti kroz nekoliko sati.");
            location.reload();
        }

        socket.on('greska', m => alert(m));
    </script>
</body>
</html>