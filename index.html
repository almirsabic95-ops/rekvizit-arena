<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <title>Rekvizit Arena 1vs1</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root { --accent: #00bfff; --gold: #ffd700; --bg: #0d0d0d; --panel: #161616; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; }
        .hidden { display: none !important; }
        
        /* SIDEBARS */
        .sidebar { width: 250px; background: #000; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .sidebar-right { border-right: none; border-left: 1px solid #333; }
        .list-item { padding: 10px; border-bottom: 1px solid #222; font-size: 14px; display: flex; justify-content: space-between; }

        /* MAIN */
        #main { flex: 1; display: flex; flex-direction: column; }
        .top-bar { background: #111; padding: 15px; border-bottom: 2px solid var(--accent); display: flex; justify-content: space-around; }
        #chat-box { flex: 1; padding: 20px; overflow-y: auto; background: #080808; }
        .msg { margin-bottom: 10px; }

        /* KVIZ */
        #quiz-area { background: var(--panel); padding: 30px; text-align: center; border-bottom: 1px solid #333; }
        input { padding: 12px; background: #000; border: 1px solid #333; color: white; border-radius: 5px; outline: none; width: 60%; }
        input:focus { border-color: var(--accent); }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-blue { background: var(--accent); color: white; }

        /* LOGIN */
        #login-screen { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* DUEL MODAL */
        #duel-ui { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="login-screen">
        <h1 style="font-size: 3em; letter-spacing: 3px;">REKVIZIT <span style="color:var(--accent)">ARENA</span></h1>
        <div id="login-fields">
            <input type="text" id="nick" placeholder="Nadimak" onkeypress="if(event.key==='Enter') pokusajPrijavu()"><br><br>
            <input type="password" id="pass" placeholder="Lozinka" onkeypress="if(event.key==='Enter') pokusajPrijavu()"><br><br>
            <button class="btn btn-blue" onclick="pokusajPrijavu()" style="width:100%">PRISTUPI</button>
        </div>
        <div id="secret-box" class="hidden">
            <p>Postavi tajnu ≈°ifru (prva prijava):</p>
            <input type="password" id="secret" placeholder="≈†ifra" onkeypress="if(event.key==='Enter') zavrsiRegistraciju()"><br><br>
            <button class="btn btn-blue" onclick="zavrsiRegistraciju()">SAƒåUVAJ</button>
        </div>
    </div>

    <div class="sidebar">
        <div style="padding:15px; color:var(--accent); font-weight:bold;">ONLINE IGRAƒåI</div>
        <div id="online-list"></div>
    </div>

    <div id="main">
        <div class="top-bar">
            <span>üèÜ EXP: <b id="stat-bodovi">0</b></span>
            <span>üí∞ COINS: <b id="stat-coins">0</b></span>
            <span style="color:var(--accent)">üíª CISCO: <b id="stat-cisco">0</b></span>
        </div>

        <div id="quiz-area">
            <h2 id="q-text">ƒåekanje na pitanje...</h2>
            <input type="text" id="ans-in" placeholder="Odgovori ovdje..." onkeypress="if(event.key==='Enter') posaljiOdgovor()">
        </div>

        <div id="chat-box"></div>

        <div style="padding:15px; background:#111; display:flex;">
            <input type="text" id="chat-in" placeholder="Globalni chat..." style="flex:1" onkeypress="if(event.key==='Enter') posaljiChat()">
        </div>
    </div>

    <div class="sidebar sidebar-right">
        <div style="padding:15px; color:var(--gold); font-weight:bold;">LEADERBOARD</div>
        <div id="leader-list"></div>
    </div>

    <div id="duel-ui" class="hidden">
        <h1 style="color:var(--gold)">‚öîÔ∏è 1 VS 1 DUEL ‚öîÔ∏è</h1>
        <h3 id="duel-protivnik">Protivnik: ...</h3>
        <div style="background:#222; padding:30px; border-radius:10px; width:80%; text-align:center;">
            <h2 id="duel-pitanje">...</h2>
            <input type="text" id="duel-ans" placeholder="Tvoj BRZI odgovor..." onkeypress="if(event.key==='Enter') posaljiDuelOdgovor()">
        </div>
    </div>

    <script>
        const socket = io();
        let trenutniRoom = null;

        function pokusajPrijavu() {
            socket.emit('provjeri_korisnika', { nadimak: document.getElementById('nick').value, lozinka: document.getElementById('pass').value });
        }
        function zavrsiRegistraciju() {
            socket.emit('registruj_novog', { nadimak: document.getElementById('nick').value, lozinka: document.getElementById('pass').value, tajna_sifra: document.getElementById('secret').value });
        }

        socket.on('prijavljen', (u) => {
            document.getElementById('login-screen').classList.add('hidden');
            updateStats(u);
        });

        function posaljiOdgovor() {
            const inp = document.getElementById('ans-in');
            socket.emit('slanje_odgovora', { odgovor: inp.value });
            inp.value = "";
        }

        function posaljiChat() {
            const inp = document.getElementById('chat-in');
            socket.emit('chat_global', inp.value);
            inp.value = "";
        }

        socket.on('osvezi_listu', (users) => {
            document.getElementById('online-list').innerHTML = users.map(u => `
                <div class="list-item">
                    ${u.nadimak} 
                    <button onclick="socket.emit('izazovi_igraca', '${u.id}')">‚öîÔ∏è</button>
                </div>
            `).join('');
        });

        socket.on('leaderboard', (list) => {
            document.getElementById('leader-list').innerHTML = list.map((u, i) => `
                <div class="list-item"><span>${i+1}. ${u.nadimak}</span> <b>${u.bodovi}</b></div>
            `).join('');
        });

        socket.on('dobio_izazov', (data) => {
            if(confirm(`${data.odKoga} te izaziva na 1vs1! Prihvaƒáa≈°?`)) {
                socket.emit('prihvati_izazov', data);
            }
        });

        socket.on('start_duel', (data) => {
            trenutniRoom = `room_` + (socket.id < data.odId ? socket.id : data.odId); // Pojednostavljeno
            document.getElementById('duel-ui').classList.remove('hidden');
            document.getElementById('duel-pitanje').innerText = data.pitanje;
            document.getElementById('duel-protivnik').innerText = "Protivnik: " + data.protivnik;
        });

        function posaljiDuelOdgovor() {
            const inp = document.getElementById('duel-ans');
            socket.emit('slanje_odgovora', { odgovor: inp.value, room: trenutniRoom }); // Server treba doradu za room ID
            inp.value = "";
        }

        socket.on('duel_gotov', (data) => {
            alert("Pobjednik duela: " + data.pobjednik);
            document.getElementById('duel-ui').classList.add('hidden');
            trenutniRoom = null;
        });

        socket.on('chat_msg', (d) => {
            const box = document.getElementById('chat-box');
            box.innerHTML += `<div class="msg"><b>${d.od}:</b> ${d.tekst}</div>`;
            box.scrollTop = box.scrollHeight;
        });

        socket.on('update_stats', updateStats);
        function updateStats(u) {
            document.getElementById('stat-bodovi').innerText = u.bodovi;
            document.getElementById('stat-coins').innerText = u.coinsi;
            document.getElementById('stat-cisco').innerText = u.ciscoBodovi || 0;
        }
        socket.on('greska', m => alert(m));
    </script>
</body>
</html>